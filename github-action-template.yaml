jobs:
  deploy:
    runs-on: windows-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Install Az PowerShell
        run: |
          Install-Module -Name Az -Repository PSGallery -Force -Scope CurrentUser
        shell: pwsh

      - name: Install Azure CLI + Bicep
        run: |
          Invoke-WebRequest -Uri https://aka.ms/installazurecliwindows -OutFile .\AzureCLI.msi
          Start-Process msiexec.exe -ArgumentList '/I AzureCLI.msi /quiet' -Wait
          az bicep install
        shell: pwsh

      - name: Run deployment script
        run: pwsh ./KeyVault/deploy-keyvault-dev.ps1
